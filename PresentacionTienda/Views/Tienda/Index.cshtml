
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .floating-button {
        position: fixed;
        bottom: 70px;
        right: 20px;
    }

    /* Estilos del icono */
    .floating-button a {
        display: block;
        width: 50px;
        height: 50px;
        background-color: #25d366; /* Color de fondo de WhatsApp */
        color: #fff; /* Color del icono */
        border-radius: 50%;
        text-align: center;
        line-height: 50px; /* Centra verticalmente el icono */
        font-size: 24px; /* Tamaño del icono */
        text-decoration: none;
        transition: background-color 0.3s;
    }
</style>

<div class="card rounded-4">
    <div class="card-body">
        <h5 class="py-1"> </h5>
        <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner rounded-4">
                <div class="carousel-item active">
                    <img src="~/assets/img/banner.png" class="d-block w-100 rounded-4" alt="..." style="max-height: 500px;">
                    <div class="carousel-caption d-none d-md-block">
                        <h5 class="fw-bold">Nombre Tendencia</h5>
                        <p>Some representative placeholder content for the first slide.</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="~/assets/img/baner-2.png" class="d-block w-100 rounded-4" alt="..." style="max-height: 500px;">
                    <div class="carousel-caption d-none d-md-block">
                        <h5 class="fw-bold">Tendencia 2</h5>
                        <p>Some representative placeholder content for the second slide.</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="~/assets/img/baner3.png" class="d-block w-100 rounded-4" alt="..." style="max-height: 500px;">
                    <div class="carousel-caption d-none d-md-block">
                        <h5 class="fw-bold">Tendencia 3</h5>
                        <p>Some representative placeholder content for the third slide.</p>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
</div>

<section class="py-1">
    <div class="container-fluid">
        <div class="row">
            <!-- Categorias y Marcas -->
            <div class="col-lg-3" style="position: inherit;">
                <div class="row mb-3">
                    <div class="col-sm-12">
                        <div class="card rounded-4">
                            <div class="card-header rounded-4 text-white fw-semibold" style="background-color: #698BF6;">
                                Categorias
                            </div>
                            <div id="con_categoria" class="card-body">

                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-12">
                        <div class="card rounded-4">
                            <div class="card-header rounded-4 text-white fw-semibold" style="background-color: #698BF6;">
                                Marcas
                            </div>
                            <div id="con_marcas" class="card-body">

                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-12">
                        <div class="card rounded-4">
                            <div class="card-header rounded-4 text-white fw-semibold" style="background-color: #698BF6;">
                                Tallas
                            </div>
                            <div id="con_tallas" class="card-body">

                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-12">
                        <div class="d-grid gap-2">
                            <button id="btn_aplicarfiltro" class="btn btn-outline-primary btn-block" type="button"><i class="bi bi-funnel"></i> Aplicar Filtros</button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Tarjetas de Producto -->
            <div class="col-md-9">
                <div id="container_productos" class="row row-cols-1 row-cols-md-3 g-3">

                </div>
            </div>
        </div>
    </div>
</section>
<!-- Botón de WhatsApp -->
<div class="floating-button">
    <a href="https://api.whatsapp.com/send?phone=933103242&text=Hola" target="_blank">
        <i class="bi bi-whatsapp"></i>
    </a>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            listarCategorias();
            listarMarcas();
            mostrarFiltros(0, 0, 0);
        })

        function listarCategorias() {
            jQuery.ajax({
                url: "@Url.Action("ListaCategorias", "Tienda")",
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (response) {
                    $("#con_categoria").LoadingOverlay("hide");
                    $("<div>").addClass("form-check mt-2").append(
                        $("<input>").addClass("form-check-input").attr({ "type": "radio", "name": "categoria", "value": "0", "id": "cx", "checked": "checked" }),
                        $("<label>").addClass("form-check-label").text("Todos").attr({ "for": "cx" })
                    ).appendTo("#con_categoria")

                    $.each(response.data, function (i, element) {
                        $("<div>").addClass("form-check mt-2").append(
                            $("<input>").addClass("form-check-input").attr({ "type": "radio", "name": "categoria", "value": element.idcategoria, "id": "cat" + i }),
                            $("<label>").addClass("form-check-label").text(element.nombrecategoria).attr({ "for": "cat" + 1 })
                        ).appendTo("#con_categoria")
                    })
                    mostrarTallas();
                },
                beforeSend: function () {
                    $("#con_categoria").LoadingOverlay("show");
                }
            })
        }

        function listarMarcas() {
            jQuery.ajax({
                url: "@Url.Action("FiltroMarca", "Tienda")",
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (response) {
                    $("#con_marcas").LoadingOverlay("hide");
                    $("<div>").addClass("form-check mt-2").append(
                        $("<input>").addClass("form-check-input").attr({ "type": "radio", "name": "marcas", "value": "0", "id": "mx", "checked": "checked" }),
                        $("<label>").addClass("form-check-label").text("Todos").attr({ "for": "mx" })
                    ).appendTo("#con_marcas")

                    $.each(response.data, function (i, element) {
                        $("<div>").addClass("form-check mt-2").append(
                            $("<input>").addClass("form-check-input").attr({ "type": "radio", "name": "marcas", "value": element.idmarca, "id": "ct" + i }),
                            $("<label>").addClass("form-check-label").text(element.nombremarca).attr({ "for": "ct" + 1 })
                        ).appendTo("#con_marcas")
                    })
                },
                beforeSend: function () {
                    $("#con_marcas").LoadingOverlay("show");
                }
            })
        }

        function mostrarTallas() {
            var _idcategoria = $("input[name=categoria]:checked").val();
            jQuery.ajax({
                url: "@Url.Action("FiltroTallas", "Tienda")",
                type: "POST",
                data: JSON.stringify({ idcategoria: _idcategoria }),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (response) {
                    $("#con_tallas").html("");
                    $("#con_tallas").LoadingOverlay("hide");
                    $("<div>").addClass("form-check mt-2").append(
                        $("<input>").addClass("form-check-input").attr({ "type": "radio", "name": "tallasropa", "value": "0", "id": "tx", "checked": "checked" }),
                        $("<label>").addClass("form-check-label").text("Todos").attr({ "for": "tx" })
                    ).appendTo("#con_tallas")

                    $.each(response.data, function (i, element) {
                        $("<div>").addClass("form-check mt-2").append(
                            $("<input>").addClass("form-check-input").attr({ "type": "radio", "name": "tallasropa", "value": element.idtallaropa, "id": "t" + i }),
                            $("<label>").addClass("form-check-label").text(element.nombretalla).attr({ "for": "t" + 1 })
                        ).appendTo("#con_tallas")
                    })
                },
                beforeSend: function () {
                    $("#con_tallas").LoadingOverlay("show");
                }
            })
        }

        $(document).on("change", "input[name=categoria]", function () {
            mostrarTallas();
        })

        function mostrarFiltros(_idcategoria, _idmarca, _idtallaropa) {
            jQuery.ajax({
                url: "@Url.Action("listarProductos", "Tienda")",
                type: "POST",
                data: JSON.stringify({ idcategoria: _idcategoria, idmarca: _idmarca, idtallaropa : _idtallaropa }),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (response) {
                    $("#container_productos").html("");
                    $("#container_productos").LoadingOverlay("hide");

                    if (response.data.length === 0) {
                        $("<section>").addClass("section error-404 min-vh-100 d-flex flex-column align-items-center justify-content-center").append(
                            $("<h2>").addClass("text-center").text("Error al encontrar los productos"),
                            $("<h5>").addClass("text-center").text("El producto que estas buscando no existe")
                        ).appendTo("#container_productos")

                    }
                    else {
                        $.each(response.data, function (i, element) {
                            var imagenSrc;
                            if (element.Extension && element.base64) {
                                imagenSrc = "data:image/" + element.Extension + ";base64," + element.base64;
                            } else {
                                imagenSrc = "assets/img/logovalent.png";
                            }

                            $("<div>").addClass("col mb-5").append(
                                $("<div>").addClass("card h-100 rounded-4").append(
                                    $("<img>").addClass("card-img-top rounded-4").attr({ "src": imagenSrc, "height": "230" }),
                                    $("<div>").addClass("card-body p-4").append(
                                        $("<div>").addClass("text-center").append(
                                            $("<h6>").text("Codigo: ").append(
                                                $("<span>").addClass("badge text-decoration bg-primary").text(element.codigo)
                                            ),
                                            $("<h5>").addClass("fw-bolder").text("Nombre: " + element.nombre),
                                            "Precio: " + element.precioventa.toFixed(2) + " S/"
                                        ),
                                        $("<div>").addClass("card-footer p-4 pt-0 border-top-0 bg-transparent").append(
                                            $("<div>").addClass("d-grid gap-2").append(
                                                @if (Session["cliente"] != null)
                                                    {
                                                        @:$"<button>").addClass("btn btn-lg btn-link fs-6 text-decoration-none border-end agregarcarrito").data("idproducto", element.idproducto).text("Agregar a carrito"),
                                                    }
                                                $("<div>").addClass("text-center mt-4 mb-0").append(
                                                    $("<a>").addClass("btn btn-outline-dark mt-auto ").attr({ "href": "@Url.Action("DetalleProducto", "Tienda")" + "?idproducto=" + element.idproducto }).text("Ver Detalles")
                                                )
                                            )
                                         )
                                    )
                                )
                            ).appendTo("#container_productos")
                        })
                    }
                },
                beforeSend: function() {
                    $("#container_productos").LoadingOverlay("show");
                }
            })
        }

        $("#btn_aplicarfiltro").click(function () {
            var _idcategoria = $("input[name=categoria]:checked").val()
            var _idmarca = $("input[name=marcas]:checked").val()
            var _idtallaropa = $("input[name=tallasropa]:checked").val()
            mostrarFiltros(_idcategoria, _idmarca, _idtallaropa)
        })

    </script>
}